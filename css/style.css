/* ==========================================
   全域設定與佈局 (Global & Layout)
   ========================================== */
body { 
    background-color: #020205; 
    color: #d0d0d0; 
    font-family: '微軟正黑體', 'MS PGothic', monospace; 
    margin: 0; 
    display: flex; 
    justify-content: center; 
    align-items: center; 
    height: 100vh; 
    overflow: hidden; 
    user-select: none; 
}

#game-master-container { 
    width: 95vw; 
    max-width: 1400px; 
    height: 90vh; 
    max-height: 900px; 
    display: grid; 
    gap: 10px; 
    position: relative; 
    grid-template-columns: 200px 1fr 300px; 
    grid-template-rows: 1fr 240px; 
    grid-template-areas: 
        "map map sys" 
        "avatar log sys"; 
}

/* ==========================================
   共用面板樣式 (Shared Panels)
   ========================================== */
.panel { 
    background: rgba(10, 10, 15, 0.85); 
    border: 2px solid #334455; 
    border-radius: 4px; 
    padding: 10px; 
    box-sizing: border-box; 
    position: relative; 
    overflow: hidden; 
    box-shadow: inset 0 0 15px rgba(0,0,0,0.8); 
    display: flex; 
    flex-direction: column;
}

.panel-title { 
    color: #88aaff; 
    font-size: 13px; 
    font-weight: bold; 
    border-bottom: 1px solid #334455; 
    padding-bottom: 5px; 
    margin-bottom: 5px; 
}

/* ==========================================
   各區域特定樣式 (Specific Areas)
   ========================================== */
#area-map { grid-area: map; border-color: #55aaff; padding: 0; align-items: center; justify-content: center; background: #000; }
#map-canvas { display: block; }

#area-avatar { grid-area: avatar; border-color: #ffaa55; align-items: center; }
.avatar-title { color: #ffaa55; font-weight: bold; margin-bottom: 5px; }
.avatar-aa-box { font-size: 20px; color: #aaddff; background: #111; border: 1px solid #555; padding: 15px; text-align: center; }
.avatar-stats { margin-top: 10px; font-size: 13px; color: #aaa; }
.avatar-sub-stats { font-size: 12px; color: #888; }

#area-log { grid-area: log; border-color: #88aa88; font-size: 14px; line-height: 1.5; }
#log-content { flex: 1; overflow-y: auto; padding-right: 5px; }

#area-sys { grid-area: sys; border-color: #aa55ff; }

/* ==========================================
   系統右欄介面 (System Panel UI)
   ========================================== */
.sys-tabs { display: flex; gap: 4px; margin-bottom: 8px; }
.tab-btn { flex: 1; background: #111; border: 1px solid #445; color: #aaa; padding: 6px 0; cursor: pointer; text-align: center; font-size: 13px; transition: 0.2s; font-weight: bold;}
.tab-btn:hover { background: #334; color: #fff; }
.tab-btn.active { background: #55aaff; color: #000; border-color: #fff; }

#sys-content { flex: 1; border: 1px dashed #445; padding: 8px; overflow-y: auto; font-size: 13px; color: #ddd; background: #08080a;}
.list-item { display: flex; justify-content: space-between; align-items: center; padding: 6px; border-bottom: 1px solid #223; }
.list-item:hover { background: #1a1a25; }
.sys-btn { background: #223; border: 1px solid #55aaff; color: #fff; cursor: pointer; padding: 4px 8px; font-size: 12px; }
.sys-btn:hover { background: #55aaff; color: #000; }

/* ==========================================
   頂層特效與動態視窗 (VFX & Windows)
   ========================================== */
/* 修正重點：將 VFX 層級拉到最高，確保覆蓋所有 UI 與視窗 */
#vfx-layer { 
    position: absolute; 
    top: 0; 
    left: 0; 
    width: 100%; 
    height: 100%; 
    pointer-events: none; 
    z-index: 9999; /* <-- 從 10 改為 9999 */
}

#floating-windows-container { 
    position: absolute; 
    top: 0; 
    left: 0; 
    width: 100%; 
    height: 100%; 
    pointer-events: none; 
    z-index: 50; 
    overflow: hidden;
}

.draggable-window { 
    position: absolute; 
    background: rgba(0,0,10,0.95); 
    border: 2px solid #ffdd55; 
    pointer-events: auto; 
    display: flex; 
    flex-direction: column; 
    min-width: 320px; 
    box-shadow: 0 10px 30px rgba(0,0,0,0.9); 
    /* z-index 會由 JS 動態指定，通常在 51 以上 */
}
/* 戰鬥視窗專屬 */
.battle-ui { display: flex; justify-content: space-between; margin-bottom: 15px; align-items: flex-end;}
.aa-box { font-size: 14px; line-height: 1.1; color: #ffaaaa; margin: 10px 0; text-align: center; font-family: 'MS PGothic', monospace; }
.bar-bg { width: 100px; height: 6px; background: #333; margin-top: 4px; border: 1px solid #000;}
.bar-fill { height: 100%; background: #ff5555; transition: 0.2s;}
.bat-log-container { height: 80px; overflow-y: auto; background: #111; padding: 5px; font-size: 12px; margin-top: 10px; border: 1px solid #333; }

/* ==========================================
   文字顏色標籤 (Text Colors)
   ========================================== */
.sys-msg { color: #55ff55; } 
.warn-msg { color: #ff5555; } 
.story-msg { color: #ffdd55; } 
.dmg-msg { color: #ff6666; font-weight: bold; }
.color-hp { color: #ff5555; font-weight: bold; }
.color-lv { color: #fff; }
.color-exp { color: #55aaff; }
/* ==========================================
   動畫效果 (Animations)
   ========================================== */
@keyframes shake {
    0% { transform: translate(1px, 1px) rotate(0deg); }
    20% { transform: translate(-3px, 0px) rotate(1deg); }
    40% { transform: translate(1px, -1px) rotate(0deg); }
    60% { transform: translate(-3px, 1px) rotate(-1deg); }
    80% { transform: translate(-1px, -1px) rotate(1deg); }
    100% { transform: translate(1px, 1px) rotate(0deg); }
}

.shake-effect {
    animation: shake 0.3s;
    animation-iteration-count: 1;
}

/* 確保戰鬥視窗內的 AA 排版置中對齊 */
#bat-aa-p, #bat-aa-e {
    margin: 10px 0;
    min-height: 80px;
    display: flex;
    align-items: center;
    justify-content: center;
}