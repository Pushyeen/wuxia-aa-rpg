/* css/style.css */

/* ==========================================
   全域設定與佈局 (Classic DOS Global & Layout)
   ========================================== */
body { 
    background-color: #000; /* 純黑背景 */
    /* 模擬早期 CRT 螢幕的微弱掃描線/點陣感 */
    background-image: radial-gradient(circle, #222 1px, transparent 1px);
    background-size: 4px 4px; 
    color: #d0d0d0; 
    /* UI 介面使用經典細明體，展現 DOS 時代感 */
    font-family: 'PMingLiU', 'MingLiU', '細明體', monospace; 
    margin: 0; 
    display: flex; 
    justify-content: center; 
    align-items: center; 
    height: 100vh; 
    overflow: hidden; 
    user-select: none; 
}

#game-master-container { 
    width: 100vw; 
    max-width: 1280px; 
    height: 100vh; 
    max-height: 800px; 
    display: grid; 
    gap: 6px; /* 稍微加寬以容納粗邊框 */
    position: relative; 
    padding: 10px;
    background-color: #111;
    border: 4px outset #555; /* 遊戲機台外殼質感 */
    
    /* 維持你的核心佈局需求 */
    grid-template-columns: 290px 1fr 320px; 
    grid-template-rows: 1fr 280px; 
    grid-template-areas: 
        "map map sys" 
        "avatar log sys"; 
}

/* ==========================================
   復古面板樣式 (Classic DOS Panels)
   ========================================== */
.panel { 
    background: #000; /* DOS 遊戲標準純黑底 */
    border: 4px double #aaa; /* 經典雙線邊框 */
    border-radius: 0; /* 移除現代圓角 */
    padding: 10px; 
    box-sizing: border-box; 
    position: relative; 
    overflow: hidden; 
    display: flex; 
    flex-direction: column;
}

.panel-title { 
    background: #0000aa; /* 經典 DOS 標題藍色 */
    color: #fff; 
    font-size: 16px; 
    font-weight: bold; 
    text-align: center;
    letter-spacing: 4px;
    padding: 4px 0; 
    margin: -10px -10px 10px -10px; /* 延伸至邊框 */
    border-bottom: 4px double #aaa; 
}

/* 復古捲軸樣式 (Windows 95 / DOS GUI 風格) */
::-webkit-scrollbar { width: 14px; }
::-webkit-scrollbar-track { background: #000; border-left: 2px solid #555; }
::-webkit-scrollbar-thumb { background: #aaa; border: 2px outset #eee; }
::-webkit-scrollbar-thumb:active { border: 2px inset #eee; }

/* ==========================================
   各區域特定樣式 (Specific Areas)
   ========================================== */
#area-map { grid-area: map; padding: 0; align-items: center; justify-content: center; background: #000; }
#map-canvas { display: block; image-rendering: pixelated; /* 強化像素感 */ }

#area-avatar { grid-area: avatar; align-items: center; }
.avatar-title { color: #ffff55; font-weight: bold; margin-bottom: 5px; font-size: 16px; }
.avatar-stats { margin-top: 10px; font-size: 15px; color: #aaa; }
.avatar-sub-stats { font-size: 14px; color: #888; }

#area-log { grid-area: log; font-size: 15px; line-height: 1.6; }
#log-content { flex: 1; overflow-y: auto; padding-right: 5px; }

#area-sys { grid-area: sys; }

/* ==========================================
   系統右欄介面 (Retro System Panel UI)
   ========================================== */
.sys-tabs { display: flex; gap: 0; margin-bottom: 8px; border-bottom: 4px double #aaa; }
.tab-btn { 
    flex: 1; 
    background: #000; 
    border: 2px outset #888; 
    border-bottom: none;
    color: #aaa; 
    padding: 6px 0; 
    cursor: pointer; 
    text-align: center; 
    font-size: 15px; 
    font-weight: bold;
    font-family: inherit;
}
.tab-btn:hover { background: #222; color: #fff; }
.tab-btn.active { 
    background: #0000aa; /* 啟動時變成 DOS 藍 */
    color: #fff; 
    border: 2px inset #aaa; 
    border-bottom: none;
}

#sys-content { flex: 1; border: 2px inset #555; padding: 10px; overflow-y: auto; font-size: 14px; color: #ddd; background: #000;}
.list-item { display: flex; justify-content: space-between; align-items: center; padding: 6px; border-bottom: 1px dotted #555; }
.list-item:hover { background: #000044; } /* 復古高亮 */
.sys-btn { 
    background: #000; 
    border: 2px outset #888; 
    color: #fff; 
    cursor: pointer; 
    padding: 4px 10px; 
    font-size: 13px; 
    font-family: inherit;
}
.sys-btn:active { border: 2px inset #888; background: #222; }

/* ==========================================
   頂層特效與動態視窗 (VFX & DOS Windows)
   ========================================== */
#vfx-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; }
#floating-windows-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 50; overflow: hidden;}

.draggable-window { 
    position: absolute; 
    background: #000; 
    border: 4px double #aaa; /* 復古雙線視窗 */
    pointer-events: auto; 
    display: flex; 
    flex-direction: column; 
    min-width: 320px; 
    box-shadow: 10px 10px 0 rgba(0,0,0,0.8); /* 復古硬陰影 */
}
.drag-header { 
    background: #0000aa; 
    color: #fff; 
    padding: 6px 10px; 
    font-size: 16px; 
    font-weight: bold; 
    letter-spacing: 2px;
    cursor: grab; 
    display: flex; 
    justify-content: space-between; 
    border-bottom: 4px double #aaa; 
}
.drag-header:active { cursor: grabbing; }
.drag-content { padding: 15px; font-size: 16px; line-height: 1.6; color: #fff; }

/* 戰鬥視窗專屬 */
.battle-ui { display: flex; justify-content: space-between; margin-bottom: 15px; align-items: flex-end;}
.aa-box { font-size: 14px; line-height: 1.1; color: #ffaaaa; margin: 10px 0; text-align: center; font-family: 'MS PGothic', monospace; }
.bar-bg { width: 100px; height: 12px; background: #000; margin-top: 4px; border: 2px inset #555;}
.bar-fill { height: 100%; background: #aa0000; transition: 0.2s;}
.bat-log-container { height: 80px; overflow-y: auto; background: #000; padding: 8px; font-size: 14px; margin-top: 10px; border: 2px inset #555; }

/* 16 色復古文字標籤 (DOS 16-color Palette) */
.sys-msg { color: #aaaaaa; } 
.warn-msg { color: #ff5555; } 
.story-msg { color: #55ffff; } 
.dmg-msg { color: #ffff55; font-weight: bold; }
.color-hp { color: #ff5555; font-weight: bold; }
.color-lv { color: #fff; }
.color-exp { color: #55ffff; }

/* ==========================================
   高級 AA 展演圖層與動畫 (Layered AA)
   (維持 AA 素體的 MS PGothic 字型以防止跑版)
   ========================================== */
.avatar-aa-box { 
    position: relative;
    width: 100%;
    height: 190px;
    flex: 1; 
    background: #000; 
    border: 2px inset #555; 
    overflow: hidden; 
    display: flex;
    justify-content: center;
    align-items: center; 
    margin: 5px 0;
}

.avatar-container {
    width: 280px;
    height: 260px;
    position: relative;
    transform-origin: center center;
    transform: scale(0.6); 
    animation: avatar-breath 3s infinite ease-in-out;
}

.aa-layer-body {
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0; left: 0;
    font-family: 'MS PGothic', 'ＭＳ Ｐゴシック', monospace;
    font-size: 11px;
    line-height: 1.1;
    white-space: pre;
    color: #d0d0d0;
    transition: color 0.5s ease, text-shadow 0.5s ease;
    display: flex;
    justify-content: center;
    align-items: flex-end; 
}

.aa-layer-weapon {
    position: absolute;
    font-family: 'MS PGothic', 'ＭＳ Ｐゴシック', monospace;
    font-size: 11px;
    line-height: 1.1;
    white-space: pre;
    font-weight: bold;
    z-index: 5;
    transition: all 0.3s ease;
}

/* 動畫設定維持不變 */
@keyframes avatar-breath {
    0%, 100% { transform: scale(var(--base-scale, 0.6)) translateY(0); }
    50% { transform: scale(var(--base-scale, 0.6)) translateY(-3px); }
}
@keyframes weapon-equip {
    0% { transform: scale(0) rotate(-50deg); opacity: 0; filter: brightness(3); }
    50% { transform: scale(1.5) rotate(10deg); filter: brightness(2) drop-shadow(0 0 15px #fff); opacity: 1; }
    100% { transform: scale(1) rotate(0deg); filter: brightness(1); }
}
.anim-equip { animation: weapon-equip 0.4s ease-out forwards; }
@keyframes avatar-attack-thrust {
    0% { transform: scale(var(--base-scale, 0.6)) translateX(0); }
    30% { transform: scale(var(--base-scale, 0.6)) translateX(40px); filter: drop-shadow(0 0 10px #55aaff); }
    100% { transform: scale(var(--base-scale, 0.6)) translateX(0); }
}
.anim-attack-thrust { animation: avatar-attack-thrust 0.3s ease-out forwards; }
@keyframes avatar-attack-slash {
    0% { transform: scale(var(--base-scale, 0.6)) rotate(0deg) translateX(0); }
    30% { transform: scale(var(--base-scale, 0.6)) rotate(15deg) translateX(30px); filter: drop-shadow(0 0 10px #ffaa55); }
    100% { transform: scale(var(--base-scale, 0.6)) rotate(0deg) translateX(0); }
}
.anim-attack-slash { animation: avatar-attack-slash 0.4s ease-out forwards; }
@keyframes avatar-hurt {
    0% { transform: scale(var(--base-scale, 0.6)) translateX(0); filter: brightness(1); }
    20% { transform: scale(var(--base-scale, 0.6)) translateX(-15px) rotate(-5deg); filter: brightness(2) drop-shadow(0 0 15px red); }
    100% { transform: scale(var(--base-scale, 0.6)) translateX(0); filter: brightness(1); }
}
.anim-hurt { animation: avatar-hurt 0.4s ease-out forwards; }

#combat-avatar-container { --base-scale: 0.75; }
#ui-avatar-container { --base-scale: 0.6; }

@keyframes shake {
    0% { transform: translate(1px, 1px) rotate(0deg); }
    20% { transform: translate(-3px, 0px) rotate(1deg); }
    40% { transform: translate(1px, -1px) rotate(0deg); }
    60% { transform: translate(-3px, 1px) rotate(-1deg); }
    80% { transform: translate(-1px, -1px) rotate(1deg); }
    100% { transform: translate(1px, 1px) rotate(0deg); }
}
.shake-effect { animation: shake 0.3s; animation-iteration-count: 1; }
#bat-aa-p, #bat-aa-e { margin: 10px 0; min-height: 80px; display: flex; align-items: center; justify-content: center; }

/* ==========================================
   內功經脈系統 (Meridian System Animations)
   ========================================== */
.acu-node {
    display: inline-block;
    transition: all 0.3s ease;
    color: #333; 
    font-size: 14px;
}

/* --- 穴位重要程度動態展演 --- */

/* 1. 起源點 (丹田)：如心臟般沉穩有力地跳動 */
.node-origin {
    font-weight: 900 !important;
    animation: meridian-origin-pulse 1.2s infinite alternate !important;
}
@keyframes meridian-origin-pulse {
    0% { transform: scale(1); filter: brightness(1); }
    100% { transform: scale(1.3); filter: brightness(1.6); }
}

/* 2. 大圓滿終點：極高亮度的旋轉光暈 (利用 filter) */
.node-terminus {
    font-weight: 900 !important;
    animation: meridian-terminus-glow 2s infinite alternate !important;
}
@keyframes meridian-terminus-glow {
    0% { transform: scale(1.1); filter: brightness(1.5) contrast(1.2); }
    100% { transform: scale(1.4); filter: brightness(2.5) contrast(1.5); }
}

/* 3. 當前衝穴關口：閃爍不定，象徵突破中 */
.node-frontier {
    font-style: italic;
    font-weight: bold;
    animation: meridian-frontier-blink 0.5s infinite alternate !important;
}
@keyframes meridian-frontier-blink {
    0% { opacity: 0.4; transform: scale(0.9); }
    100% { opacity: 1; transform: scale(1.1); filter: brightness(2); }
}

/* 4. 途經節點：平穩的亮起 */
.node-transit {
    font-weight: bold;
}
/* ==========================================
   戰鬥標籤與承載區 (Combat Tags & Zones)
   ========================================== */
.zone-box { border: 1px solid #444; padding: 5px; font-size: 13px; min-height: 30px; margin-top: 5px; background: #111; text-align: left;}
.zone-title { color: #ffff55; font-size: 12px; margin-bottom: 3px; border-bottom: 1px dotted #555; }
.env-zone { min-height: 40px; text-align: center; color: #888; margin-top: 5px;}

.tag { display: inline-block; padding: 1px 3px; font-size: 11px; margin-right: 3px; margin-top: 4px; background: #222; color: #fff; border-radius: 2px; border: 1px solid #444;}
.tag.ice { color: #55aaff; border-color:#55aaff;} .tag.fire { color: #ff5555; border-color:#ff5555;} .tag.blunt { color: #ddaa77; border-color:#ddaa77;} 
.tag.wind { color: #55ff55; border-color:#55ff55;} .tag.pull { color: #cc55ff; border-color:#cc55ff;} .tag.trap { color: #aaa; border-color:#aaa;}
.tag.silk { color: #ff55aa; border-color:#ff55aa;} .tag.soft { color: #aaddff; border-color:#aaddff;} .tag.aura { color: #ffff55; border-color:#ffff55;}

/* ==========================================
   傷害飄浮數字特效 (Floating Damage Numbers)
   ========================================== */
.dmg-float-base {
    position: absolute;
    transform: translate(-50%, -50%);
    pointer-events: none; /* 避免干擾點擊 */
    z-index: 999;
    font-weight: 900;
    font-family: 'Arial Black', Impact, sans-serif;
    /* 復古街機風格的厚重黑邊 */
    text-shadow: 2px 2px 0 #000, -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 4px 4px 0 rgba(0,0,0,0.8);
    opacity: 0;
}

/* Tier 1: 一般傷害 (< 25%) - 輕微往上飄 */
.dmg-tier-1 { color: #ffffff; font-size: 24px; animation: floatNormal 1.2s ease-out forwards; }

/* Tier 2: 沉重一擊 (25% ~ 49%) - 放大並呈現橘色 */
.dmg-tier-2 { color: #ffaa00; font-size: 36px; animation: floatHeavy 1.2s ease-out forwards; }

/* Tier 3: 猛烈打擊 (50% ~ 74%) - 紅色劇烈彈跳 */
.dmg-tier-3 { color: #ff5555; font-size: 50px; animation: floatCritical 1.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; text-shadow: 0 0 10px #ff0000, 2px 2px 0 #000, -2px -2px 0 #000; }

/* Tier 4: 致命重創 (75% ~ 99%) - 紫光爆裂與鏡頭震顫 */
.dmg-tier-4 { color: #ff00ff; font-size: 65px; animation: floatFatal 1.4s ease-out forwards; text-shadow: 0 0 20px #ff00ff, 3px 3px 0 #000, -3px -3px 0 #000; }

/* Tier 5: 一擊必殺 (>= 100%) - 誇張的金色爆閃，巨大化 */
.dmg-tier-5 { color: #ffffaa; font-size: 90px; animation: floatAnnihilation 1.5s ease-out forwards; text-shadow: 0 0 30px #ff0000, 0 0 15px #ffff00, 4px 4px 0 #000; }

/* 基礎上升動畫 */
@keyframes floatNormal {
    0% { opacity: 1; transform: translate(-50%, 0) scale(0.5); }
    20% { transform: translate(-50%, -20px) scale(1.1); }
    100% { opacity: 0; transform: translate(-50%, -60px) scale(1); }
}

/* 沉重打擊的滯空感 */
@keyframes floatHeavy {
    0% { opacity: 1; transform: translate(-50%, 0) scale(0.5); }
    15% { transform: translate(-50%, -30px) scale(1.3); }
    30% { transform: translate(-50%, -25px) scale(1.1); }
    100% { opacity: 0; transform: translate(-50%, -70px) scale(1); }
}

/* 暴擊特效：彈出與快速縮放 */
@keyframes floatCritical {
    0% { opacity: 1; transform: translate(-50%, 0) scale(0.2); }
    20% { transform: translate(-50%, -40px) scale(1.5); }
    40% { transform: translate(-50%, -35px) scale(1.2); }
    100% { opacity: 0; transform: translate(-50%, -80px) scale(1.2); }
}

/* 致命特效：左右震動再上飄 */
@keyframes floatFatal {
    0% { opacity: 1; transform: translate(-50%, 0) scale(0.5) rotate(-10deg); }
    10% { transform: translate(-40%, -20px) scale(1.8) rotate(10deg); }
    20% { transform: translate(-60%, -30px) scale(1.6) rotate(-5deg); }
    30% { transform: translate(-50%, -40px) scale(1.4) rotate(0deg); }
    100% { opacity: 0; transform: translate(-50%, -90px) scale(1.4) rotate(0deg); }
}

/* 毀滅特效：爆閃與極致滯空 */
@keyframes floatAnnihilation {
    0% { opacity: 1; transform: translate(-50%, 10px) scale(0.1); filter: brightness(3); }
    15% { transform: translate(-50%, -50px) scale(2.0); filter: brightness(2); }
    30% { transform: translate(-50%, -40px) scale(1.6); filter: brightness(1); }
    50% { opacity: 1; transform: translate(-50%, -45px) scale(1.7); }
    100% { opacity: 0; transform: translate(-50%, -100px) scale(1.5) filter: blur(2px); }
}

/* ==========================================
   武俠風連段特效 (Wuxia Style Combo Rating)
   ========================================== */
.wuxia-combo-container {
    position: absolute;
    pointer-events: none;
    z-index: 1000;
    display: none;
    font-family: 'PMingLiU', 'MingLiU', '細明體', serif;
}

/* 整體字體縮小 */
.wuxia-combo-count {
    font-size: 16px; 
    font-weight: bold;
    letter-spacing: 2px;
    color: #ffffff;
    text-shadow: 0 0 8px rgba(255, 255, 255, 0.8);
}

.wuxia-combo-rank {
    font-size: 22px; 
    font-weight: 900;
    margin-top: 5px;
    letter-spacing: 4px;
}

/* 移除所有改變 font-size 的設定，尺寸鎖死不變 */
.combo-tier-1 { color: #cccccc; animation: wuxiaFadeIn 0.3s ease-out; }
.combo-tier-2 { color: #55aaff; animation: wuxiaGlow 0.4s ease-out; text-shadow: 0 0 10px #55aaff; } 
.combo-tier-3 { color: #ffff55; animation: wuxiaGlow 0.4s ease-out; text-shadow: 0 0 15px #ffff55; } 
.combo-tier-4 { color: #ff5555; animation: wuxiaShake 0.3s ease-out; text-shadow: 0 0 20px #ff0000; } 
.combo-tier-5 { color: #ff55aa; animation: wuxiaUltimate 0.5s ease-out infinite alternate; text-shadow: 0 0 25px #ff00ff; }

/* 動畫全部拔除 scale() 放大效果，改為純粹的光影與平移震動 */
@keyframes wuxiaFadeIn {
    0% { opacity: 0; transform: translateY(5px); }
    100% { opacity: 1; transform: translateY(0); }
}
@keyframes wuxiaGlow {
    0% { filter: brightness(2.5); }
    100% { filter: brightness(1); }
}
@keyframes wuxiaShake {
    0% { transform: translateX(-3px); filter: brightness(2); }
    25% { transform: translateX(3px); }
    50% { transform: translateX(-2px); }
    100% { transform: translateX(0); filter: brightness(1); }
}
@keyframes wuxiaUltimate {
    0% { filter: brightness(1) drop-shadow(0 0 5px #ff00ff); }
    100% { filter: brightness(1.6) drop-shadow(0 0 15px #ffffff); }
}